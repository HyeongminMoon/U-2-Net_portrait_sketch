<head>
    <style>
      @import url(//fonts.googleapis.com/earlyaccess/jejumyeongjo.css);

      .jm-font{
          font-family: 'Jeju Myeongjo', serif;/*웹 폰트 지정*/
          color: black;
      }
      .b {
        background-color: #BBDEFB;
        padding: 10px 20px;
      }
    </style>
</head>

{% if page.title == "Home" %}

<h5 class="jm-font"> 머리말 </h5>
<p class="jm-font"> - 두번째 회사에서 입사하고 처음으로 맡게된 큰 프로젝트이다. 전체 프로젝트 내용은 영상을 4컷웹툰으로 바꾸는 것으로 전체 과정은 {키프레임 추출 및 이미지 캡셔닝-> 글자 제거-> 손실 영역 복원-> 
    스케치-> 얼굴변환} 이다. 이 글에서는 내가 주로 맡았고, 가장 많은 것을 익히게 되었던 스케치에 대한 부분을 이야기해보려고 한다. </p>
<p class="jm-font"> - 회사에서 진행한 일은 라이센스 상 문제가 될 수 있어서 코드레벨까지 공개하진 않는다. 따라서 최대한 겪었던 문제와 어떻게 해결해는 지에 대해서 이야기한다. 나의 개발철학 상에서도
    코드는 하나의 도구일 뿐이지 중요한건 솔루션 과정에 발생한 문제해결을 위한 의사결정이다.</p>
<p class="jm-font"> - 이 글에서는 아무것도 없던 황무지에서 스케치모델을 개발해내면서 부딪혔던 수 많은 문제들과 해결방법들을 소개한다. 여담이지만, 터닝포인트가 될만한 솔루션이 나올때마다
    그때의 모델에 이름을 붙여서 예뻐하곤 했다. 열심히 공부하는 인공지능 아가의 아버지가 된 기분이랄까.</p>
<br></br>

<h5 class="jm-font"> 개요</h5>
<p class="jm-font"> - 스케치 모델은 언뜻보면 생성모델이니 GAN을 사용할 것 같다. 실제로 GAN은 사진을 특정한 그림체 느낌으로 변형하는 모델이나, 초상화의 헤어스타일, 성별등을 변형하는 모델에 많이 활용되고 있다.
    그러나 GAN은 아직 불안정한 단계에 있고 범용성이 떨어져 얼굴뿐만 아니라 몸통, 옷, 배경 등을 포괄적으로 적용하기가 어렵다. 손이 얼굴로 인식되어 얼굴처럼 스케치되는 기이한 광경을 보고싶진 않다. 
    언제나 그렇듯 모델은 도구일뿐이므로, 필요에 따라 선택하면 될 것이다.
    한편, 세그멘테이션을 극도로 발전시키면 CNN으로도 스케치모델을 만들 수 있다. 이번에는 CNN을 활용하여 스케치 생성 모델을 만드는 과정을 설명한다.</p>
<br></br>

<h5 class="jm-font"> 이미지 전처리를 통한 학습 데이터 수집</h5>
<p class="jm-font"> - 주어진 문제에 따라 학습 데이터 수집 방법 또한 달라진다. 가장 좋은 경우는 당연히 지도학습할 문제 자체에 해당하는 학습 데이터가 존재하는 것이다. 또는 만드는 것이 간단하다면,
    예를들어 문제가 "헬멧을 쓴 사람과 쓰지 않은 사람을 구분하자" 이면 헬멧을 쓴 사람과 쓰지 않은 사람을 찍어서 헬멧을 쓴 부분을 바운딩 박스로 표시하면 된다.</p>
<p class="jm-font"> - 그러나 모든 문제가 이렇게 단순하다면 얼마나 좋을까. 때로는 수집할 수 없는 데이터 대상으로 학습해야하며, 때로는 지도할 수 없는(답이 정해지지않은) 데이터를 학습해야한다. 그리고 단순한 작업이어도
    수십만개의 이미지에 수동으로 라벨링하기에는 많은 비용이 낭비된다. 이런경우에 활용할 수 있는 학습 데이터 수집방법들이 있다.</p>
<p class="jm-font"> - 첫번째는 Opencv를 활용해서 데이터 전처리 및 수정하는 것이다. 특히 Opencv에서는 다양한 기능을 제공하는데, 내가 써보았던 방법들을 나열해보자면, Threshold를 통해 일정 밝기 이하의 픽셀을 제거하거나,
    Contour를 통해 mask를 딴 뒤 Contour Area를 활용해서 작은 노이즈를 지우거나 특정 색깔로 채울 수 있으며, bounding box를 구해서 자동으로 라벨링 하거나, minrect를 구해 물체의 기울기를 
    구할 수도 있고, 여러가지 Blur나 Morphology를 통해 물체의 테두리를 굵게/얇게 할 수도 있다. 이외에도 정말 많은 기능들이 있으니 그 기능들을 활용해서 데이터를 만드려고 검토해보자.
    </p>
<p class="jm-font"> - 두번째는 다른 비슷한 인공지능 모델을 이용하는 것이다. 이 프로젝트에서의 활용방안을 예시로 들면, APDrawingGAN 이라는 초상화 GAN을 활용할 수 있었다. 우리의 목표는 얼굴뿐만 아닌 몸, 사물까지도
    스케치 하는 것이지만 이 모델을 활용하면 적어도 얼굴이 나온 사진들의 스케치 데이터를 얻을 수 있다. 우리가 가진 사진 중에서 얼굴이 크게 나온 사진들을 걸러내고, 이 사진들에 모델을 적용시켜서 
    초상화 데이터셋을 늘려나갔다.</p>
<p class="jm-font"> - 세번째는 데이터를 확장하는 방법이다. 라벨링 되지 않은 이미지 10만장 중에 위 두가지 방법을 통해 쓸만한 100장을 건져냈다면 우선 가벼운 모델에 이 100장을 학습하는 것이다.
    그리고 그 가벼운 모델에 10만장을 적용시켜 양질의 데이터를 수집하고, 점점 고도화된 모델에 학습하기를 반복하면서 데이터 량을 늘려나가는 것이다. 여기서 어그멘테이션이나 Opencv등을 활용하면 더욱 빠르게
    데이터 량을 늘릴 수 있다. 이 프로젝트에서의 활용방안을 예시로 들면, 처음에 수집한 초상화 데이터를 CNN 모델을 통해 학습했더니 처음엔 큰 얼굴만 잘 그리는 모습을 확인했다. 따라서 다른 얼굴인식
    모델을 가져와 얼굴의 크기를 어그멘테이션하여 학습하니 작은 얼굴도 잘 그리게 되었다. 그리고 다시 그 데이터를 학습하니 스케치에서 옷표현이 섬세해지기 시작했다. 그 다음에 얼굴을 모자이크 하게끔
    전처리하여 옷만을 학습하니 배경이 스케치되기 시작했다. 이때 나온 결과가 다음과 같다.</p>
<img src="https://user-images.githubusercontent.com/32811724/143386103-8eb3fb3b-8bed-4f37-8a49-3b4ef1718fe4.png" width="45%">
<br></br>

<h5 class="jm-font"> 배경의 노이즈 없애기 & 빈 머리카락 채우기</h5>
<p class="jm-font"> - 기본 모델을 얻게되면 그 뒤에는 점점 가속이 붙는다. 위의 결과를 보면 아직 배경엔 검은색 노이즈가 많고, 머리카락이 제대로 채워지지 않는 모습이다. 이것을 Opencv의 Contour를
    활용해서 일정 Area 이하의 Contour의 내부가 검은색이면 지우고, 하얀색이면 채우는 식으로 어그멘테이션을 진행했다. 그리고 Morphology(중 Erode)와 Blur들(Midean blur와 Guausian blur)을
    적절히 사용해서 전체적인 선이 깔끔해 보이도록 처리하였다. 그리하여 나온 결과는 아래와 같다.</p>
<img src="https://user-images.githubusercontent.com/32811724/143386178-d2eeb72e-2a33-43c8-b0f8-713efbf30709.png" width="45%">
<p class="jm-font"> - 이로써 우리가 아는 보통의 부드러운 스케치 모델이 완성되었다. 영상에도 적용해 보았다.</p>
<img src="https://user-images.githubusercontent.com/32811724/143388489-1d9e0756-58e9-4ab6-98f9-ca0f0c044869.gif" alt="IU_Coin_train_custom_erode2 (1)" width="45%">
<br></br>

<h5 class="jm-font"> 옷 주름 없애기 & 캐릭터화 하기</h5>
<p class="jm-font"> - 조금 더 캐릭터 다운 스케치를 위해 유니크한 스타일로 보이도록 옷의 주름을 없애고 더욱 더 깔끔하고 강렬한 선이 되도록 학습했다. 이를 위해 정말 많은 커스텀 어그멘테이션을
    사용했는데, 하나의 예시를 들면, 사람의 테두리에 랜덤한 모자이크 패치를 붙여 사람과 배경이 구분이 되어 사람이 주요해 보이도록 했다.</p>
<br></br>

<h5 class="jm-font"> 기타 적용했던 방법들 </h5>
<p class="jm-font"> - 그 외에는 다양한 데이터에 사용될 수 있게 Random Affine과 Copy-Paste-Aug를 적용했다. 그리고 검은색과 흰색으로만 표현되는 스케치와 달리 원본 사진에는 초점이나 밝기를 통해 원근이 표현되는데,
    사진에서의 원근을 스케치에서 최대한 표현하기 위해선 사진에서 멀리있는 느낌을 주는 부분은 얇고 짧은 선으로 그리도록 해야한다. 이는 사진에 Blur와 ColorJitter를 적용할 때마다 해당하는
    스케치 부분의 선을 얇고 짧게 바꾸도록 해서 해결하였다. 그리하여 나온 결과는 아래와 같다.</p>

<img src="https://user-images.githubusercontent.com/32811724/143386196-e7215ff1-7b2c-4e9c-8554-4bd8c94fc3ff.png" width="45%"></img>
<img src="https://user-images.githubusercontent.com/32811724/143388497-3237d2db-3b80-4309-97f3-a4d7aae28321.gif" alt="Traffic_light_custom_b2" width="45%">



<div class="row g-5 mb-5" style="text-align:left">
<hr width = "90%" color = "black">
<h5> Project Links </h5>
      {% for item in site.data.publications.featured %}
        <p><a href="{{ item.url }}">{{ item.name }}</a></p>
      {% endfor %}
    {% else %}
      includes publications.html
      {% for item in site.data.publications.index %}
        <p><a href="{{ item.url }}">{{ item.name }}</a></p>
      {% endfor %}
    {% endif %}
</div>
